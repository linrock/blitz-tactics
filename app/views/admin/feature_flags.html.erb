<% content_for(:title) { "Feature Flags - Admin" } %>

<div class="admin-page">
  <div class="container">
    <header>
      <h1>Feature Flags Management</h1>
      <p class="subtitle">Enable and disable features across the application</p>
    </header>

    <!-- Create New Feature Flag Form -->
    <div class="feature-flag-form">
      <h2>Create New Feature Flag</h2>
      <%= form_with model: [:admin, FeatureFlag.new], url: admin_feature_flags_path, local: true, class: "feature-flag-form-inner" do |form| %>
        <div class="form-group">
          <%= form.label :name, "Feature Name" %>
          <%= form.text_field :name, placeholder: "e.g., new_achievements_system", required: true %>
        </div>
        
        <div class="form-group">
          <%= form.label :description, "Description" %>
          <%= form.text_area :description, placeholder: "Describe what this feature flag controls", rows: 3 %>
        </div>
        
        <div class="form-group checkbox-group">
          <%= form.check_box :enabled %>
          <%= form.label :enabled, "Enable immediately" %>
        </div>
        
        <%= form.submit "Create Feature Flag", class: "blue-button" %>
      <% end %>
    </div>

    <!-- Existing Feature Flags -->
    <div class="feature-flags-list">
      <h2>Existing Feature Flags</h2>
      
      <% if @feature_flags.any? %>
        <div class="feature-flags-grid">
          <% @feature_flags.each do |flag| %>
            <div class="feature-flag-card <%= flag.enabled? ? 'enabled' : 'disabled' %>">
              <div class="feature-flag-header">
                <h3><%= flag.name %></h3>
                <div class="feature-flag-status">
                  <span class="status-indicator <%= flag.enabled? ? 'enabled' : 'disabled' %>">
                    <%= flag.enabled? ? '✅ Enabled' : '❌ Disabled' %>
                  </span>
                </div>
              </div>
              
              <% if flag.description.present? %>
                <p class="feature-flag-description"><%= flag.description %></p>
              <% end %>
              
              <div class="feature-flag-actions">
                <%= form_with url: admin_toggle_feature_flag_path(flag), method: :post, local: true, class: "inline-form" do |form| %>
                  <%= form.submit flag.enabled? ? "Disable" : "Enable", 
                      class: flag.enabled? ? "red-button small" : "green-button small" %>
                <% end %>
                
                <%= form_with url: admin_feature_flag_path(flag), method: :delete, local: true, 
                    class: "inline-form", 
                    data: { confirm: "Are you sure you want to delete this feature flag?" } do |form| %>
                  <%= form.submit "Delete", class: "red-button small" %>
                <% end %>
              </div>
              
              <div class="feature-flag-meta">
                <small>Created: <%= flag.created_at.strftime("%b %d, %Y at %I:%M %p") %></small>
                <% if flag.updated_at != flag.created_at %>
                  <small>Updated: <%= flag.updated_at.strftime("%b %d, %Y at %I:%M %p") %></small>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="no-feature-flags">
          <p>No feature flags have been created yet.</p>
          <p>Create your first feature flag using the form above.</p>
        </div>
      <% end %>
    </div>

    <!-- Usage Examples -->
    <div class="usage-examples">
      <h2>Usage Examples</h2>
      <div class="code-examples">
        <div class="code-block">
          <h4>In Ruby/Rails code:</h4>
          <pre><code># Check if a feature is enabled
if FeatureFlag.enabled?(:new_achievements_system)
  # Show new achievements
else
  # Show old achievements
end

# Enable/disable features programmatically
FeatureFlag.enable!(:new_achievements_system, description: "New achievements system")
FeatureFlag.disable!(:old_feature)

# Toggle a feature
FeatureFlag.toggle!(:experimental_feature)</code></pre>
        </div>
        
        <div class="code-block">
          <h4>In views (ERB):</h4>
          <pre><code>&lt;% if FeatureFlag.enabled?(:new_achievements_system) %&gt;
  &lt;%= render 'new_achievements' %&gt;
&lt;% else %&gt;
  &lt;%= render 'old_achievements' %&gt;
&lt;% end %&gt;</code></pre>
        </div>
      </div>
    </div>

    <div class="admin-navigation">
      <%= link_to "← Back to Admin Dashboard", admin_path, class: "blue-button" %>
    </div>
  </div>
</div>
